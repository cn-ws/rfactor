<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; rfactor 0.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code legacy" href="../codelegacy.html" />
    <link rel="prev" title="rfactor package" href="../api/rfactor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> rfactor
          </a>
              <div class="version">
                0.0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../rfactor.html">R-factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">Module Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codelegacy.html">Code legacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rfactor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/cn-ws/rfactor/blob/master/docs/notebooks/analysis_flanders.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<dl>
<dt>{</dt><dd><dl>
<dt>“cells”: [</dt><dd><dl>
<dt>{</dt><dd><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“# OPTIONAL: Load the &quot;autoreload&quot; extension so that code can changen”,
“%load_ext autoreloadn”,
“# OPTIONAL: always reload modules so that as you change code in src, it gets loadedn”,
“%autoreload 2”</p>
</div></blockquote>
<p>]</p>
</dd>
</dl>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“# Tutorial “</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Aimn”,
“n”,
“Implementation to compute and analyse the R-factor of the RUSLE-equation. Then”,
“R-factor is a measure for the total erosivity of a number of rainfall eventsn”,
“within a defined timeframe (year, month, number of days). The factor isn”,
“computed by calculating the yearly sum of -for every rainfall event- the sumn”,
“of the depth of rainfall (mm) and the kinetic energy, and taking the meann”,
“over all years.n”,
“n”,
“—n”,
“__NOTE__n”,
“n”,
“This notebook does not include the erosivity computation based on the Royal Meteorological Institute of Belgium (RMI) rainfall data, as the data is not available as open data. One can contact RMI to obtain the rainfall input data. Alternatively, the results of the computation of the erosivity values based on the RMI data are provided in this notebook as well as other rainfall input data, so one can proceed with the analysis.n”,
“n”,
“—”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Package imports”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“from pathlib import Pathn”,
“n”,
“import numpy as npn”,
“import pandas as pdn”,
“import matplotlib.pyplot as plt”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Load the <cite>rfactor</cite> package functionalities”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“from rfactor import compute_erosivity, maximum_intensity, maximum_intensity_matlab_clonen”,
“from rfactor.process import load_rain_folder, compute_rainfall_statistics, get_rfactor_station_year”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Input data and compute erosivityn”,
“n”,
“__Set <a href="#id1"><span class="problematic" id="id2">folders__</span></a>n”,
“n”,
“The main function <cite>compute_erosivity</cite> requires a [pandas DataFrame](<a class="reference external" href="https://pandas.pydata.org/docs/index.html">https://pandas.pydata.org/docs/index.html</a>) containing __non-<a href="#id1"><span class="problematic" id="id3">zero__</span></a> rainfall data with the following columns:n”,
“n”,
“- datetime (pd.Timestamp): Time stampn”,
“- rain_mm (float): Rain in mmn”,
“- station (str): Measurement station identifiern”,
“n”,
“However, the legacy format of the input files used in the original Matlab implementation is still supported as well. For this format, te input files are defined by text files (extension: <cite>txt</cite>) that hold __non-zero <a href="#id1"><span class="problematic" id="id4">rainfall__</span></a> timeseries. The data are split per station and per year with a specific data file tag <cite>STATION_YYYY</cite>:  n”,
“n”,
“<code class="docutils literal notranslate"><span class="pre">`\n&quot;,</span>
<span class="pre">&quot;KMI_6414_2004.txt</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;KMI_6414_2005.txt</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;...</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;KMI_6434_2003.txt</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;KMI_6434_2004.txt</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;...</span>&#160; <span class="pre">\n&quot;,</span>
<span class="pre">&quot;`</span></code>n”,
“n”,
“__Note__: the files in <cite>tests/data/test_rainfalldata</cite> are an incomplete data set for Belgium (RMI rainfall data are not included), an alternative is provided in the section ‘Analysis’. “</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“fmap_rainfall =  Path(r&quot;../../tests/data/test_rainfalldata&quot;)n”,
“fmap_erosivity = Path(r&quot;../../tests/data/test_erosivitydata&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Use the <cite>load_rain_folder</cite> function to read all rain data in a folder:”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“all_rainfall = load_rain_folder(fmap_rainfall)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Compute rainfall statistics</strong> (and add station metadata)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“stations = pd.read_csv(&quot;data/belgium/stations.csv&quot;)n”,
“n”,
“rain_stats = compute_rainfall_statistics(all_rainfall, stations)n”,
“rain_stats.head()”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Select stations to compute erosivity for</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“consider_stations = pd.read_csv(&quot;../../tests/data/files_tests.csv&quot;)n”,
“n”,
“sel_rainfall = all_rainfall.loc[all_rainfall[&quot;tag&quot;].isin(consider_stations[&quot;datafile&quot;])]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“sel_rainfall”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Run Model</strong>  “</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“By default, the erosivity is calculated with the <cite>maximum_intensity</cite> method implemented in Python, which follows a slightly different approach to the original Matlab implementation. However, one can opt to use the <cite>matlab_clone</cite> method as well, which is a Python implementation mimicking the original one:”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“erosivity = compute_erosivity(sel_rainfall, maximum_intensity_matlab_clone)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Analysis (in Dutch)n”,
“n”,
“If one does not have acces to the RMI data, the output erosivity from the computation with the full data set is provided in this repository as an alternative:”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“erosivity = pd.read_csv(&quot;data/erosivity_belgium.csv&quot;, parse_dates=[0, 1], index_col=0)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Ukkel</strong>  n”,
“n”,
“Compute R-factor for specific periods for Ukkel (KMI_6447 and KMI_F3).”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“timeseries = [range(1898,2003,1),n”,
”              range(2003,2021,1),n”,
”              range(1898,2021,1),n”,
”              range(1996,2021,1),n”,
”              range(1991,2021,1),n”,
”              range(1990,2001,1),n”,
”              range(2000,2021,1)]n”,
“n”,
“for period in timeseries:n”,
”    rfactor = get_rfactor_station_year(erosivity,[&quot;KMI_6447&quot;,&quot;KMI_FS3&quot;], period)n”,
”    print(f&quot;R-factor for period from {period[0]} till {period[-1]} is: {rfactor[‘erosivity_cum’].mean()}&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Make figure for Ukkel</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“rfactor_all= get_rfactor_station_year(erosivity, stations=[&quot;KMI_FS3&quot;, &quot;KMI_6447&quot;]).sort_values(&quot;year&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“fig, ax = plt.subplots(figsize=(12, 7.5))n”,
“n”,
“rfactor_fs3 = get_rfactor_station_year(erosivity, [&quot;KMI_FS3&quot;])n”,
“rfactor_fs3 = rfactor_fs3[~(rfactor_fs3[&quot;erosivity_cum&quot;].isnull())].sort_values(&quot;year&quot;)n”,
“n”,
“rfactor_6447 = get_rfactor_station_year(erosivity, [&quot;KMI_6447&quot;])n”,
“rfactor_6447 = rfactor_6447[~(rfactor_6447[&quot;erosivity_cum&quot;].isnull())].sort_values(&quot;year&quot;)n”,
“n”,
“# add first line of KMI6447 to end of KMI FS3 in order to make a continuous timeseries on the plotn”,
“rfactor_fs3 = rfactor_fs3.append(rfactor_6447.iloc[0])n”,
“n”,
“ax.plot(rfactor_fs3[&quot;year&quot;], rfactor_fs3[&quot;erosivity_cum&quot;], label=&quot;KMI_FS3 (1898-2002)&quot;)n”,
“n”,
“n”,
“ax.plot(rfactor_6447[&quot;year&quot;], rfactor_6447[&quot;erosivity_cum&quot;], label=&quot;KMI_6447 (2003-2020)&quot;)n”,
“n”,
“# rolling meann”,
“rfactor_all = get_rfactor_station_year(erosivity, stations=[&quot;KMI_FS3&quot;, &quot;KMI_6447&quot;]).sort_values(&quot;year&quot;)n”,
“windows  = [10, 20, 30]n”,
“for window in windows:n”,
”    y = rfactor_all.rolling(window)[&quot;erosivity_cum&quot;].mean()n”,
”    ax.plot(rfactor_all[&quot;year&quot;], y, ls=’:’, lw=3, n”,
”            label=f&quot;Moving average ({window} year window)&quot;)n”,
”    n”,
“n”,
“ax.set_ylim([0,3500])n”,
“ax.set_xlim([1890,2020])n”,
“ax.tick_params(axis=’both’, which=’major’, labelsize=14)n”,
“ax.set_xlabel(r’Year’,fontsize=16)n”,
“ax.set_ylabel(r’Yearly R-factor [MJ mm ha$^{-1}$ h$^{-1}$ year$^{-1}$]’,fontsize=16)n”,
“ax.legend(prop={‘size’:16})”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>All stations expect Ukkel</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“stations_belgium_excl_ukkel = [station for station in stations[&quot;station&quot;] n”,
”                               if station not in [&quot;KMI_6447&quot;,&quot;KMI_FS3&quot;, &quot;KMI1990_2002&quot;, &quot;KMI2003_nu_v2&quot;]]n”,
“years = range(1898, 2021, 1)n”,
“years = [year for year in years if year in n”,
”         erosivity[erosivity[&quot;station&quot;].isin(stations_belgium_excl_ukkel)][&quot;year&quot;].unique()]n”,
“n”,
“rfactor_non_ukkel = get_rfactor_station_year(erosivity, n”,
”                                             stations=stations_belgium_excl_ukkel, n”,
”                                             years=years)n”,
“print(rfactor_non_ukkel[&quot;erosivity_cum&quot;].mean())n”,
“len(rfactor_non_ukkel[&quot;station&quot;].unique())”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>All stations flanders</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“stations_flanders = [station for station in stations[&quot;station&quot;] n”,
”                     if station not in  [&quot;KMI_6447&quot;, &quot;KMI_FS3&quot;, &quot;KMI_6455&quot;, &quot;KMI_6459&quot;,n”,
”                                         &quot;KMI_6472&quot;, &quot;KMI_6494&quot;, &quot;KMI_6484&quot;, &quot;KMI1990_2002&quot;, &quot;KMI2003_nu_v2&quot;]]n”,
“years = range(1898, 2021, 1)n”,
“years = [year for year in years if year in n”,
”         erosivity[erosivity[&quot;station&quot;].isin(stations_flanders)][&quot;year&quot;].unique()]n”,
“n”,
“rfactor_flanders = get_rfactor_station_year(erosivity,stations_flanders, years)n”,
“print(rfactor_flanders[&quot;erosivity_cum&quot;].mean())n”,
“len(rfactor_flanders[&quot;station&quot;].unique())”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Plot the distribution of all R-values for Belgium, excluding the data from Ukkel</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“years = [year for year in range(1991, 2021) if year in n”,
”         erosivity[erosivity[&quot;station&quot;].isin(stations_belgium_excl_ukkel)][&quot;year&quot;].unique()]n”,
“n”,
“rfactor_non_ukkel = get_rfactor_station_year(erosivity, stations_belgium_excl_ukkel, years)n”,
“n”,
“fig, ax = plt.subplots()n”,
“ax.hist(rfactor_non_ukkel[&quot;erosivity_cum&quot;], bins=20, color=[0.8]*3,n”,
”        label=r&quot;Jaarlijkse waarden voor alle 55 stations in België&quot;)n”,
“ax.plot([1239, 1239], [0, 120], color=[0.2]*3, ls=&quot;:&quot;, label=&quot;Ukkel (30-jaar referentie periode)&quot;)n”,
“ax.set_ylabel(r&quot;#&quot;)n”,
“ax.set_xlabel(r&quot;R-waarde [MJ mm ha$^{-1}$ h$^{-1}$ jaar$^{-1}$]&quot;)n”,
“ax.set_ylim([0,130])n”,
“ax.legend()”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>All stations of the VMM (Flanders)</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“erosivity”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“stations_vmm = [station for station in stations[&quot;station&quot;] if &quot;KMI&quot; not in station]n”,
“n”,
“rfactor_vmm = get_rfactor_station_year(erosivity, stations_vmm)n”,
“n”,
“print(rfactor_vmm[&quot;erosivity_cum&quot;].mean())n”,
“len(rfactor_vmm[&quot;station&quot;].unique())”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Compute values per year over all stations</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“(get_rfactor_station_year(erosivity)n”,
” .groupby(&quot;station&quot;)n”,
” .aggregate(n”,
”    {&quot;erosivity_cum&quot;:[np.mean, np.std],n”,
”     &quot;year&quot;: &quot;count&quot;})n”,
” .sort_values((‘year’, ‘count’), ascending=False)n”,
” .reset_index()n”,
“)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Analysis (monthly resolution, in Dutch)n”,
“Get the EI30-values for 2018 based on two Ukkel station (&quot;KMI_6447&quot;,&quot;KMI_FS3&quot;)  “</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“erosivity_monthly = (erosivity.loc[erosivity[&quot;station&quot;].isin([&quot;KMI_6447&quot;, &quot;KMI_FS3&quot;]), &quot;erosivity&quot;]n”,
”                     .resample(&quot;M&quot;)n”,
”                     .sum()n”,
”                     .to_frame())n”,
“erosivity_monthly[&quot;month&quot;] = erosivity_monthly.index.month”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“Get meand and interquartile range of monthly R-factor”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“from functools import partial”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“tt = partial(np.percentile, 25)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“em = (erosivity_monthlyn”,
”      .groupby(&quot;month&quot;)n”,
”      .aggregate({n”,
”          &quot;erosivity&quot;:[np.mean, n”,
”                       lambda x: np.percentile(x, 25), n”,
”                       lambda x: np.percentile(x,75)]n”,
”      }))”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“em[&quot;mean&quot;] = em[&quot;erosivity&quot;][&quot;mean&quot;]n”,
“em[&quot;l_e&quot;] = em[&quot;erosivity&quot;][&quot;mean&quot;] - em[&quot;erosivity&quot;][&quot;&lt;lambda_0&gt;&quot;]n”,
“em[&quot;u_e&quot;] = em[&quot;erosivity&quot;][&quot;&lt;lambda_1&gt;&quot;] - em[&quot;erosivity&quot;][&quot;mean&quot;]”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“<strong>Plot</strong>”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“fig = plt.figure(figsize=(8, 4))n”,
“n”,
“x = np.arange(len(em))n”,
“y_gv = [26, 20, 24, 27, 70, 77, 144, 102, 68, 50, 37, 32]n”,
“y_gv2 = [35, 27, 32, 36, 86, 96, 177, 135, 89, 66, 48, 43]n”,
“plt.bar(x-0.3,em[&quot;mean&quot;],yerr=em[[&quot;l_e&quot;,&quot;u_e&quot;]].T.values,color=[0.80]*3,width=0.3,label=&quot;Ukkel (1898-2020))&quot;)n”,
“plt.bar(x,y_gv,width=0.3,color=[0.5]*3,label=&quot;Verstraeten $\it{et. al}$ (2001)&quot;)n”,
“plt.bar(x+0.3,y_gv2,width=0.3,color=[0.2]*3,label=&quot;Verstraeten $\it{et. al}$ (2006)&quot;)n”,
“plt.ylabel(&quot;R-value&quot;)n”,
“ax = fig.axesn”,
“plt.xticks(x,[&quot;Januari&quot;,&quot;Februari&quot;,&quot;Maart&quot;,&quot;April&quot;,&quot;Mei&quot;,&quot;Juni&quot;,&quot;Juli&quot;,&quot;Augustus&quot;,&quot;September&quot;,&quot;Oktober&quot;,&quot;November&quot;,&quot;December&quot;],rotation=45)n”,
“plt.legend(loc=2,facecolor =&quot;white&quot;)n”,
“plt.ylabel(r&quot;R-waarde [MJ mm ha$^{-1}$ h$^{-1}$ maand$^{-1}$]&quot;)”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “markdown”,
“metadata”: {},
“source”: [</p>
<blockquote>
<div><p>“## Additional: monthly analysis (detail)n”,
“<strong>Evolution monthly R-value</strong>n”,
“Generate plot to analyse evolution of montly R over the years”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>},
{</p>
<blockquote>
<div><p>“cell_type”: “code”,
“execution_count”: null,
“metadata”: {},
“outputs”: [],
“source”: [</p>
<blockquote>
<div><p>“def subplot_montlhy_R(df,ax,ind1,ind2):n”,
”    n”,
”    if (ind1==0) &amp; (ind2==2):n”,
”        ax.plot(df[&quot;year&quot;],df[&quot;erosivity&quot;],color=[0.1]*3,alpha=0.5,label=&quot;EI30&quot;)n”,
”    else:n”,
”        ax.plot(df[&quot;year&quot;],df[&quot;erosivity&quot;],color=[0.1]*3,alpha=0.5)n”,
”    ax.fill_between([1998,2021], 0,500,facecolor=’grey’, alpha=0.3)    n”,
”    # rolling meann”,
”    scales  = [10,20,30]n”,
”    for scale in scales:n”,
”        y = df[&quot;erosivity&quot;].reset_index().rolling(scale).mean()n”,
”        if scale==10:n”,
”            y_max=np.nanmax(y.values)*1.1n”,
”        x = y.index+1898n”,
”        ax.plot(x,y,lw=2,label=f’voortschrijdend gemiddelde ({scale} jaar)’)n”,
”    if ind1!=3:n”,
”        ax.set_xticks([])n”,
”    else:n”,
”        if ind2==1:n”,
”            ax.set_xlabel(r’Jaar (-)’,fontsize=16)n”,
”    ax.set_ylim([0,500])n”,
”    ax.set_title(name)n”,
”    ax.tick_params(axis=’y’, which=’major’, labelsize=12,rotation=90)n”,
”    ax.tick_params(axis=’x’, which=’major’, labelsize=12)n”,
”    if ind2!=0:n”,
”        ax.set_yticklabels([])n”,
”    else:n”,
”        if ind1==2:n”,
”            ax.set_ylabel(’\t\t\t Maandelijkse R [MJ mm ha$^{-1}$ h$^{-1}$ maand$^{-1}$]’,fontsize=16)n”,
”    if (ind1==0) &amp; (ind2==2):n”,
”        ax.legend(ncol=2)n”,
”        n”,
“fig,ax = plt.subplots(4,3,figsize=[9,9])n”,
“months = [&quot;Januari&quot;,&quot;Februari&quot;,&quot;Maart&quot;,&quot;April&quot;,&quot;Mei&quot;,&quot;Juni&quot;,&quot;Juli&quot;,&quot;Augustus&quot;,&quot;September&quot;,&quot;Oktober&quot;,&quot;November&quot;,&quot;December&quot;]n”,
“erosivity_monthly[&quot;year&quot;] = erosivity_monthly.index.yearn”,
“n”,
“for month,name in enumerate(months):n”,
”    ind1=int(np.floor((month)/3))n”,
”    ind2=np.mod(month,3)n”,
”    df_plot = erosivity_monthly.loc[erosivity_monthly[&quot;month&quot;]==month+1]n”,
”    df_plot  = df_plot [~np.isnan(df_plot[&quot;erosivity&quot;])].sort_values(&quot;year&quot;)n”,
”    subplot_montlhy_R(df_plot,ax[ind1,ind2],ind1,ind2)n”,
“n”</p>
</div></blockquote>
<p>]</p>
</div></blockquote>
<p>}</p>
</dd>
</dl>
<p>],
“metadata”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“kernelspec”: {</dt><dd><p>“display_name”: “Python [conda env:rfactor]”,
“language”: “python”,
“name”: “conda-env-rfactor-py”</p>
</dd>
</dl>
<p>},
“language_info”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“codemirror_mode”: {</dt><dd><p>“name”: “ipython”,
“version”: 3</p>
</dd>
</dl>
<p>},
“file_extension”: “.py”,
“mimetype”: “text/x-python”,
“name”: “python”,
“nbconvert_exporter”: “python”,
“pygments_lexer”: “ipython3”,
“version”: “3.9.5”</p>
</div></blockquote>
<p>},
“toc”: {</p>
<blockquote>
<div><p>“base_numbering”: 1,
“nav_menu”: {},
“number_sections”: true,
“sideBar”: true,
“skip_h1_title”: false,
“title_cell”: “Table of Contents”,
“title_sidebar”: “Contents”,
“toc_cell”: false,
“toc_position”: {},
“toc_section_display”: true,
“toc_window_display”: false</p>
</div></blockquote>
<p>},
“varInspector”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“cols”: {</dt><dd><p>“lenName”: 16,
“lenType”: 16,
“lenVar”: 40</p>
</dd>
</dl>
<p>},
“kernels_config”: {</p>
<blockquote>
<div><dl class="simple">
<dt>“python”: {</dt><dd><p>“delete_cmd_postfix”: “”,
“delete_cmd_prefix”: “del “,
“library”: “var_list.py”,
“varRefreshCmd”: “print(var_dic_list())”</p>
</dd>
</dl>
<p>},
“r”: {</p>
<blockquote>
<div><p>“delete_cmd_postfix”: “) “,
“delete_cmd_prefix”: “rm(“,
“library”: “var_list.r”,
“varRefreshCmd”: “cat(var_dic_list()) “</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“types_to_exclude”: [</p>
<blockquote>
<div><p>“module”,
“function”,
“builtin_function_or_method”,
“instance”,
“_Feature”</p>
</div></blockquote>
<p>],
“window_display”: false</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>},
“nbformat”: 4,
“nbformat_minor”: 4</p>
</dd>
</dl>
<p>}</p>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../api/rfactor.html" class="btn btn-neutral float-left" title="rfactor package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../codelegacy.html" class="btn btn-neutral float-right" title="Code legacy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Sacha Gobeyn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>